<div id="module_wrapper" class="module_box">
  <div class="tabs">
    <span>任務一</span>
    <span>任務二</span>
  </div>

  <div class="units-title wow bounceInRight"></div>

  <div class="sideTool">
    <div class="btn_answer"></div>
    <div class="btn_replay"></div>
    <div class="btn_check"></div>
  </div>

  <div id="contents" class="contents">
    <!-- 任務一 -->
    <div>
      <div class="intro">
        <div>
          <h3>How to play?</h3>
          <p>
            <b>無包裝商店</b
            >：在無包裝商店裡為了避免食物浪費，客人可以帶著自己的容器，需要多少買多少。請你將家中的9個罐子分配給3種食材，剛好能裝下所有的食材。
          </p>
          <span class="cta" onClick="switchIntro()">START</span>
        </div>
      </div>

      <div class="wow slideInDown" style="margin-top: -30px">
        <div
          class="sensorArea"
          style="position: absolute; z-index: 2; height: 100%"
        >
          <span
            cap="500"
            style="
              position: absolute;
              width: 136px;
              height: 166px;
              top: 18px;
              left: 17px;
            "
            group="a"
          />
          <span
            cap="200"
            style="
              position: absolute;
              width: 68px;
              height: 166px;
              top: 18px;
              left: 166px;
            "
            group="b"
          />
          <span
            cap="300"
            style="
              position: absolute;
              width: 95px;
              height: 168px;
              top: 18px;
              left: 247px;
            "
            group="c"
          />
        </div>
        <img
          width="auto"
          height="200"
          src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1.png"
        />
      </div>
      <div class="ref simplyDrag wow bounceInUp">
        <img
          width="auto"
          height="185"
          src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1R.png"
        />
      </div>
      <div
        class="toys wow slideInUp noShuffle"
        style="width: 90%; left: 5%; height: 50px; bottom: 10px"
      >
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="50">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1A.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="50">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1A2.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="100">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1B.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="100">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1B1.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="100">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1B2.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="100">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1B3.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="100">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1B4.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="200">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1C.png" />
        </div>
        <div class="toy middle cards" group="a^b^c" ap="auto" cap="200">
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-1C2.png" />
        </div>
      </div>
    </div>

    <!-- 任務二 -->
    <div>
      <div class="intro">
        <div>
          <h3>How to play?</h3>
          <p>
            <b>聰明買家</b
            >：碳足跡是指從事情發生到結束的過程中，直接或間接產生的溫室氣體總量。請你安排你的購物流程。
          </p>
          <span class="cta" onClick="switchIntro()">START</span>
        </div>
      </div>

      <div class="wow slideInLeft" style="margin-right: 170px">
        <div
          class="sensorArea"
          style="position: absolute; z-index: 2; height: 100%"
        >
          <span
            ox="0"
            oy="0"
            style="
              position: absolute;
              width: 92px;
              height: 62px;
              top: 27px;
              left: 78px;
            "
            group="a"
          ></span>
          <span
            ox="0"
            oy="0"
            style="
              position: absolute;
              width: 92px;
              height: 62px;
              top: 27px;
              left: 204px;
            "
            group="b"
          ></span>
          <span
            ox="0"
            oy="0"
            style="
              position: absolute;
              width: 92px;
              height: 62px;
              top: 116px;
              left: 204px;
            "
            group="c"
          ></span>
          <span
            ox="0"
            oy="0"
            style="
              position: absolute;
              width: 92px;
              height: 62px;
              top: 116px;
              left: 78px;
            "
            group="d"
          ></span>
        </div>

        <img
          width="auto"
          height="200"
          src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-2.png"
        />
      </div>

      <div class="ref simplyDrag wow bounceInUp">
        <img
          width="auto"
          height="150"
          src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-2R.png"
        />
      </div>
      <div
        class="toys toys_rectangle noShuffle wow slideInRight"
        style="width: 220px; left: auto; right: 40px; bottom: auto"
      >
        <div
          class="toy cards"
          sp="83,132^83,257^172,257^172,132"
          ap="172,257"
          group="c^d"
          cid="A"
          style="width: 92px; height: 70px"
        >
          <div
            onClick="switchLetterA($(this))"
            class="sticker-letter"
            style="top: 44px; left: 13px; width: 54px"
            Gid="A"
          ></div>
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-2A.png" />
        </div>
        <div
          class="toy cards"
          sp="83,132^83,257^172,257^172,132"
          ap="172,132"
          group="c^d"
          cid="B"
          style="width: 92px; height: 70px"
        >
          <div
            onClick="switchLetterB($(this))"
            class="sticker-letter"
            style="top: 44px; left: 13px; width: 54px"
            ans="0"
          ></div>
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-2B.png" />
        </div>
        <div
          class="toy cards"
          sp="83,132^83,257^172,257^172,132"
          ap="83,132"
          group="a"
          cid="C"
          style="width: 92px; height: 70px"
        >
          <div
            onClick="switchLetterC($(this))"
            class="sticker-letter"
            style="top: 26px; left: 5px; width: 54px"
            ans="0"
          ></div>
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-2C.png" />
        </div>
        <div
          class="toy cards"
          sp="83,132^83,257^172,257^172,132"
          ap="83,257"
          group="b"
          cid="D"
          style="width: 92px; height: 70px"
        >
          <div
            onClick="switchLetterD($(this))"
            class="sticker-letter"
            style="top: 18px; left: 25px; width: 54px"
            ans="0"
          ></div>
          <img src="./DATA/PT2/BOOK6/IMAGES/PT2-6-4-5-2D.png" />
        </div>
      </div>
    </div>

    <div class="assetsPreload"></div>
  </div>
</div>

<style>
  .cardAvatar .sticker-letter {
    display: flex;
  }

  .sticker-letter {
    position: absolute;
    border-radius: 4px;
    width: 19px;
    height: 13px;
    z-index: 2;
    font-size: 12px;
    display: none;
    align-items: center;
    justify-content: center;
    background-image: linear-gradient(90deg, #eb6154 50%, transparent 50%),
      linear-gradient(90deg, #eb6154 50%, transparent 50%),
      linear-gradient(0deg, #eb6154 50%, transparent 50%),
      linear-gradient(0deg, #eb6154 50%, transparent 50%);
    background-repeat: repeat-x, repeat-x, repeat-y, repeat-y;
    background-size: 10px 2px, 10px 2px, 2px 10px, 2px 10px;
    background-position: left top, right bottom, left bottom, right top;
    animation: border-dance 0.6s infinite linear;
  }

  [sl] {
    background-image: unset;
    background-repeat: unset;
    background-size: unset;
    background-position: unset;
    animation: unset;
  }
  .module_box .contents .toys .toy.middle {
    width: 43px;
    height: 50px;
  }
</style>
<script>
  var stickerLettersA = ["塑膠盤", "禮盒"];
  var stickerLettersB = ["牛肉", "魚肉"];
  var stickerLettersC = ["空手", "帶環保袋"];
  var stickerLettersD = ["走路", "搭公車", "騎機車"];

  var switchLetterA = (item) => {
    event.stopPropagation();
    var sl = item.attr("sl");
    if (sl == undefined) {
      sl = 0;
    } else {
      sl = parseInt(sl);
      sl += 1;
      if (sl > stickerLettersA.length - 1) {
        sl = 0;
      }
    }
    item.attr("sl", sl);
    item.html(stickerLettersA[sl]);
    rootSoundEffect($key);
  };
  var switchLetterB = (item) => {
    event.stopPropagation();
    var sl = item.attr("sl");
    if (sl == undefined) {
      sl = 0;
    } else {
      sl = parseInt(sl);
      sl += 1;
      if (sl > stickerLettersB.length - 1) {
        sl = 0;
      }
    }
    item.attr("sl", sl);
    item.html(stickerLettersB[sl]);
    rootSoundEffect($key);
  };
  var switchLetterC = (item) => {
    event.stopPropagation();
    var sl = item.attr("sl");
    if (sl == undefined) {
      sl = 0;
    } else {
      sl = parseInt(sl);
      sl += 1;
      if (sl > stickerLettersC.length - 1) {
        sl = 0;
      }
    }
    item.attr("sl", sl);
    item.html(stickerLettersC[sl]);
    rootSoundEffect($key);
  };
  var switchLetterD = (item) => {
    event.stopPropagation();
    var sl = item.attr("sl");
    if (sl == undefined) {
      sl = 0;
    } else {
      sl = parseInt(sl);
      sl += 1;
      if (sl > stickerLettersD.length - 1) {
        sl = 0;
      }
    }
    item.attr("sl", sl);
    item.html(stickerLettersD[sl]);
    rootSoundEffect($key);
  };

  var withinResetElem = function () {
    var mid = $(".tabs > span.selected").index();

    if (mid == 0) {
      //第一單元沒有答案
      $(".sideTool > div.btn_answer").css("visibility", "hidden");
    } else {
      //第二單元有答案
      $(".sideTool > div.btn_answer").css("visibility", "visible");
    }
  };
  //dynamic function for this html only
  var withinShowAnswer = function (boolean) {
    var mid = $(".tabs > span.selected").index();

    //第二單元秀答案
    if (mid == 1) {
      $(".cardAvatar .sticker-letter").each(function () {
        var sl = parseInt($(this).attr("ans"));
        $(this).attr("sl", sl);
        var cid = $(this).parent().attr("cid");
        if (cid == "A") {
          $(this).html(stickerLettersA[0]);
        } else if (cid == "B") {
          $(this).html(stickerLettersB[0]);
        } else if (cid == "C") {
          $(this).html(stickerLettersC[0]);
        } else if (cid == "D") {
          $(this).html(stickerLettersD[0]);
        }
      });
    }
  };
  var withinCheckAnswer = function () {
    var mid = $(".tabs > span.selected").index();
    var allpass = true;
    if (mid == 1) {
      //第二單元確認答案
      var items = $(".cardAvatarDie.right").find(".sticker-letter");
      items.each(function () {
        if (!$(this).attr("sl")) {
          $(this).removeAttr("sl");
          allpass = false;
        }
      });
    } else if (mid == 0) {
      //第一單元確認答案
      console.log("測試容量是否正確");
      var sensors = $(".contents > div.selected").find(".sensorArea > span");
      for (var k = 0; k < sensors.length; k++) {
        var totalCap = parseInt(sensors.eq(k).attr("cap"));
        var toys = $(".cardAvatarDie.s" + k);
        for (var t = 0; t < toys.length; t++) {
          var cap = toys.eq(t).children().attr("cap");
          totalCap -= cap;
        }
        if (totalCap == 0) {
          $(".cardAvatarDie.s" + k).addClass("right");
        } else {
          allpass = false;
          $(".cardAvatarDie.s" + k).click();
        }
      }
    }

    if (!allpass) {
      rootSoundEffect($stupid);
      var alertmsg = "容量配置錯誤";
      if (mid == 1) {
        alertmsg = "請填入答案";
      }
      $(".alert").remove();
      $(".contents > div.selected").append(
        `<div class="alert wow bounceInUp" onclick="$(this).remove()">${alertmsg}</div>`
      );
      throw "wrong answer";
      //中斷之後的js
    }
  };
</script>
