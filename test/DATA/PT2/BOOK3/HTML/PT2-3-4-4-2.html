<div id="module_wrapper" class="module_box">
  <div class="tabs">
    <span
      class="demo"
      onClick="event.stopImmediatePropagation();loadContainerInside('PT2/BOOK3/HTML/PT2-3-4-4.html','JS/dragndropnarrow.js',0)"
      >示範</span
    >
    <span>任務一</span>
    <span style="display: none">任務一2</span>
  </div>

  <div class="units-title wow bounceInRight"></div>

  <div class="sideTool">
    <div class="btn_replay"></div>
  </div>

  <div id="contents" class="contents">
    <!-- 示範 -->

    <div></div>
    <!-- 任務ㄧ -->
    <div>
      <div class="intro">
        <div>
          <h3>How to play?</h3>
          <p>
            <b>影子推理</b>：要如何擺放物件，才能完成想要的效果？<br />
            ＊點擊物件，改變物體跟燈的距離(影子的大小跟物體距離燈的距離有關)。
          </p>
          <img src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2-1.png" />
          <span class="cta" onClick="switchIntro()">START</span>
        </div>
      </div>

      <span class="btn next" style="left: 520px" onClick="openContent(2);" />

      <div class="wow fadeIn">
        <div class="papers">
          <div
            class="item"
            style="left: 74px; bottom: 0"
            pid="1"
            posY="0"
            ans="0"
          >
            <img width="36" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2A.png" />
          </div>
          <div
            class="item"
            style="left: 206px; bottom: 0"
            pid="2"
            posY="0"
            ans="2"
          >
            <img width="34" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2B.png" />
          </div>
          <div
            class="item"
            style="left: 226px; bottom: 5px"
            pid="3"
            posY="0"
            ans="4"
          >
            <img width="30" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2C.png" />
          </div>
        </div>
        <div class="shades">
          <div class="item" style="left: 74px; bottom: 0" pid="1" offset="19">
            <img width="36" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2A.png" />
          </div>
          <div class="item" style="left: 206px; bottom: 0" pid="2" offset="19">
            <img width="34" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2B.png" />
          </div>
          <div
            class="item caterpillar"
            style="left: 210px; bottom: 5px"
            pid="3"
            offset="0"
          >
            <img
              width="30"
              src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2C.png"
              offset="19"
            />
          </div>
        </div>
        <img
          width="auto"
          height="250"
          class="wow bounceIn"
          src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2-1.png"
        />
        <div class="toys"></div>
      </div>
    </div>

    <!-- 任務ㄧ2 -->
    <div>
      <div class="intro">
        <div>
          <h3>How to play?</h3>
          <p>
            <b>影子推理</b
            >：要如何擺放物件，才能完成想要的效果？<br />＊點擊物件，改變物體跟燈的距離(影子的大小跟物體距離燈的距離有關)。
          </p>
          <img src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2-2.png" />
          <span class="cta" onClick="switchIntro()">START</span>
        </div>
      </div>
      <span class="btn prev" style="left: 110px" onClick="openContent(1);" />
      <div class="wow fadeIn">
        <div class="papers">
          <div
            class="item"
            style="left: 173px; bottom: 0"
            pid="1"
            posY="0"
            ans="0"
          >
            <img width="27" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2D.png" />
          </div>
          <div
            class="item"
            style="left: 104px; bottom: 0"
            pid="2"
            posY="0"
            ans="2"
          >
            <img width="39" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2E.png" />
          </div>
          <div
            class="item"
            style="left: 71px; bottom: 0px"
            pid="3"
            posY="0"
            ans="4"
          >
            <img width="30" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2F.png" />
          </div>
        </div>
        <div class="shades">
          <div class="item" style="left: 173px; bottom: 0" pid="1" offset="14">
            <img width="27" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2D.png" />
          </div>
          <div class="item" style="left: 104px; bottom: 0" pid="2" offset="4">
            <img width="39" src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2E.png" />
          </div>
          <div class="item butterfly" style="left: 71px; bottom: 94px" pid="3">
            <img
              width="30"
              src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2F-shade.png"
            />
          </div>
        </div>
        <img
          width="auto"
          height="250"
          class="wow bounceIn"
          src="./DATA/PT2/BOOK3/IMAGES/PT2-3-4-4-2-2.png"
        />
        <div class="toys"></div>
      </div>
    </div>
  </div>
  <div class="assetsPreload"></div>
</div>
<style>
  .papers,
  .shades {
    z-index: 5;
    position: absolute;
    top: 130px;
    left: 185px;
    width: 269px;
    height: 129px;
  }
  .shades {
    top: 44px;
    left: 185px;
    z-index: 4;
    overflow: hidden;
  }

  .papers .item,
  .shades .item {
    position: absolute;
    transform: scale(1);
    transform-origin: center bottom;
    margin-bottom: 0;
    transition: all 0.6s;
    pointer-events: auto;
  }
  .papers .item {
    cursor: pointer;
  }
  .papers .item img {
    pointer-events: auto;
  }

  .shades .item img {
    opacity: 0.3;
    filter: brightness(0) blur(0.8px);
  }
  .papers .item img,
  .shades .item img {
    position: absolute;
    left: 0;
    bottom: 0;
    transform: translate(-50%, 0);
    transform-origin: center bottom;
  }
  .shades .item.butterfly {
    transform-origin: center center;
  }
  .shades .item.butterfly img {
    transform: translate(-50%, 50%);
  }
  .shades .item.caterpillar {
    transform-origin: center left;
  }
  .shades .item.caterpillar img {
    transform: translate(0, 0);
  }
</style>
<script>
  var scaleArr = [3, 2.5, 2, 1.5, 1];
  var posyArr = [0, 26, 45, 64, 85];
  //scaleArr = [1, 1, 1, 1, 1];
  //posyArr = [0, 0, 0, 0, 0];
  var withinResetElem = function () {
    var papersItems = $(".contents > div.selected").find(".papers .item");
    var shades = $(".contents > div.selected").find(".shades");

    papersItems.each(function () {
      var posY = Math.floor(Math.random() * scaleArr.length);
      posY = 0;
      var pid = $(this).attr("pid");
      var shade = shades.find("[pid = " + pid + "]");
      $(this).attr("posY", posY);
      $(this).css("margin-bottom", posyArr[posY] + "px");
      shade.css("transform", "scale(" + scaleArr[posY] + ")");
      var offset = shade.attr("offset");
      if (posY < scaleArr.length - 1) {
        offset =
          ((scaleArr.length - 1 - posY) / (scaleArr.length - 1)) * offset * -1;
      } else {
        offset = 0;
      }
      shade.css("margin-bottom", offset + "px");
    });
    papersItems.each(function () {
      $(this)
        .unbind()
        .bind("click", function () {
          rootSoundEffect($show);
          var posY = $(this).attr("posY");
          posY = parseInt(posY) + 1;
          if (posY >= scaleArr.length) {
            posY = 0;
          }
          var pid = $(this).attr("pid");
          var shade = shades.find("[pid = " + pid + "]");

          $(this).attr("posY", posY);
          $(this).css("margin-bottom", posyArr[posY] + "px");
          shade.css("transform", "scale(" + scaleArr[posY] + ")");
          var offset = shade.attr("offset");
          if (posY < scaleArr.length - 1) {
            offset =
              ((scaleArr.length - 1 - posY) / (scaleArr.length - 1)) *
              offset *
              -1;
          } else {
            offset = 0;
          }
          shade.css("margin-bottom", offset + "px");
          //check answer
          checkShadowMatch();
        });
    });
  };

  var checkShadowMatch = function () {
    var papersItems = $(".contents > div.selected").find(".papers .item");
    var gotWrong = false;
    papersItems.each(function () {
      var posY = $(this).attr("posY");
      var ans = $(this).attr("ans");
      if (posY != ans) {
        gotWrong = true;
      }
    });
    if (!gotWrong) {
      bingo();
    }
  };
</script>
